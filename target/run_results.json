{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.3", "generated_at": "2025-05-13T23:10:53.508400Z", "invocation_id": "703a2c47-fbdd-4086-bb5d-2114ddbe3185", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:09:28.942745Z", "completed_at": "2025-05-13T23:09:28.954420Z"}, {"name": "execute", "started_at": "2025-05-13T23:09:28.955434Z", "completed_at": "2025-05-13T23:09:39.002701Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 10.0615394115448, "adapter_response": {"_message": "CREATE TABLE (207.9k rows, 54.1 MiB processed)", "code": "CREATE TABLE", "rows_affected": 207896, "bytes_processed": 56778159, "bytes_billed": 57671680, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "212299e8-a073-4eee-acfe-1284711f8aff", "slot_ms": 26428}, "message": "CREATE TABLE (207.9k rows, 54.1 MiB processed)", "failures": null, "unique_id": "model.key_academy.base_billing_orders", "compiled": true, "compiled_code": "\n\nWITH billing_orders_base AS (\n  SELECT \n    _airbyte_raw_id AS airbyte_raw_id,\n    _airbyte_extracted_at AS airbyte_extracted_at,\n    JSON_QUERY(_airbyte_meta, '$') AS airbyte_meta,\n    _airbyte_generation_id AS airbyte_generation_id,\n    REPLACE(id, 'Order:', '') AS order_id,  \n    _id AS id,\n    JSON_QUERY(acl, '$') AS acl,\n    JSON_QUERY(cart, '$') AS cart,\n    status AS billing_order_status,\n    createdAt AS created_at,\n    JSON_QUERY(purchaser, '$') AS purchaser,\n    JSON_QUERY(invoiceData, '$') AS invoice_data,\n    JSON_QUERY(paymentData, '$') AS payment_data,\n    JSON_QUERY(deletionInfo, '$') AS deletion_info,\n    _ab_cdc_cursor AS ab_cdc_cursor,\n    JSON_QUERY(customerDetails, '$') AS customer_details,\n    _ab_cdc_deleted_at AS ab_cdc_deleted_at,\n    _ab_cdc_updated_at AS ab_cdc_updated_at,\n    JSON_QUERY(allowedPaymentMethods, '$') AS allowed_payment_methods,\n    JSON_QUERY(selectedPaymentMethod, '$') AS selected_payment_method,\n  FROM `intrepid-craft-450709-f9`.`test_orders_copy`.`billing_orders`\n),\n\nunnest_data AS (\n  SELECT\n    airbyte_extracted_at,\n    airbyte_generation_id,\n    ab_cdc_deleted_at,\n    ab_cdc_updated_at,\n    airbyte_raw_id,\n    ab_cdc_cursor,\n    SAFE.JSON_VALUE(airbyte_meta, '$.changes') AS airbyte_changes, \n    SAFE.JSON_VALUE(airbyte_meta, '$.sync_id') AS airbyte_sync_id,\n    order_id,  \n    id,\n    created_at,\n    billing_order_status,\n    cart,\n    REPLACE(SAFE.JSON_VALUE(purchaser, '$.accountId'), \"Account:\", '') AS account_id,\n    REPLACE(SAFE.JSON_VALUE(purchaser, '$.userId'), \"User:\", '') AS user_id,\n    SAFE.JSON_VALUE(customer_details, '$.city') AS customer_city,\n    SAFE.JSON_VALUE(customer_details, '$.country') AS customer_country,\n    SAFE.JSON_VALUE(customer_details, '$.firstName') AS customer_first_name,\n    SAFE.JSON_VALUE(customer_details, '$.lastName') AS customer_last_name,\n    SAFE.JSON_VALUE(customer_details, '$.houseNumber') AS customer_house_number,\n    SAFE.JSON_VALUE(customer_details, '$.invoiceEmail') AS customer_invoice_email,\n    SAFE.JSON_VALUE(customer_details, '$.phoneNumber') AS customer_phone_number,\n    SAFE.JSON_VALUE(customer_details, '$.postalCode') AS customer_postal_code,\n    SAFE.JSON_VALUE(customer_details, '$.salutation') AS customer_salutation,\n    SAFE.JSON_VALUE(customer_details, '$.street') AS customer_street,\n    SAFE.JSON_VALUE(customer_details, '$.data.dateOfBirth') AS customer_date_of_birth,\n    SAFE.JSON_VALUE(customer_details, '$.data.company') AS customer_company,\n    SAFE.JSON_VALUE(customer_details, '$.data.companyDetails') AS company_details,\n    SAFE.JSON_VALUE(customer_details, '$.data.companyType') AS company_type,\n    SAFE.JSON_VALUE(customer_details, '$.data.kind') AS business_kind,\n    ARRAY_TO_STRING(JSON_VALUE_ARRAY(allowed_payment_methods, '$.paymentMethods'), ', ') AS allowed_payment_methods,\n    SAFE.JSON_VALUE(selected_payment_method, '$.kind') AS selected_payment_kind,\n    SAFE.JSON_VALUE(selected_payment_method, '$.paymentMethodType') AS selected_payment_method_type,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.downPayment.grossPrice') AS down_payment_gross,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.financedAmount.grossPrice') AS financed_amount_gross,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.monthlyRate.grossPrice') AS monthly_rate_gross,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.rateCount') AS rate_count,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.totalAmount.grossPrice') AS total_amount_gross,\n    SAFE.JSON_VALUE(payment_data, '$.iban') AS iban,\n    SAFE.JSON_VALUE(payment_data, '$.kind') AS payment_kind,\n    SAFE.JSON_VALUE(payment_data, '$.paymentMethod') AS payment_method,\n    SAFE.JSON_VALUE(invoice_data, '$.createdAt') AS invoice_created_at,\n    SAFE.JSON_VALUE(invoice_data, '$.invoiceId') AS invoice_id,\n    SAFE.JSON_VALUE(invoice_data, '$.invoiceNumber') AS invoice_number,\n    SAFE.JSON_VALUE(invoice_data, '$.kind') AS invoice_kind,\n    SAFE.JSON_VALUE(invoice_data, '$.fileData.documentFileId') AS document_file_id,\n    SAFE.JSON_VALUE(invoice_data, '$.fileData.fileDescriptionId') AS file_description_id,\n    SAFE.JSON_VALUE(payment_data, '$.mandateInformation.acceptanceDateTime') AS mandate_acceptance_datetime,\n    SAFE.JSON_VALUE(payment_data, '$.mandateInformation.mandateNumber') AS mandate_number,\n    SAFE.JSON_VALUE(deletion_info, '$.isDeleted') AS is_deleted,\n    SAFE.JSON_VALUE(deletion_info, '$.kind') AS deletion_kind\n  FROM billing_orders_base\n),\n\nunnest_cart_items AS (\n  SELECT \n    unnest_data.* EXCEPT (cart),\n    ARRAY_TO_STRING(JSON_VALUE_ARRAY(cart, '$.discountCodeRefusals'), ', ') AS cart_discount_code_refusals,\n\n    -- Items (Using UNNEST)\n    SAFE.JSON_VALUE(item, '$.amount') AS cart_item_amount,\n    SAFE.JSON_VALUE(item, '$.kind') AS cart_item_kind,\n    REPLACE(SAFE.JSON_VALUE(item, '$.productId'), \"Product:\", '') AS cart_item_product_id,\n    SAFE.JSON_VALUE(item, '$.individualPrice.grossPrice') AS cart_item_gross_price,\n    SAFE.JSON_VALUE(item, '$.individualPrice.netPrice') AS cart_item_net_price,\n    SAFE.JSON_VALUE(item, '$.individualPrice.taxRatePercentage') AS cart_item_tax_rate,\n    SAFE.JSON_VALUE(item, '$.totalPrice.grossPrice') AS cart_item_total_gross_price,\n    SAFE.JSON_VALUE(item, '$.totalPrice.netPrice') AS cart_item_total_net_price,\n    SAFE.JSON_VALUE(item, '$.totalPrice.taxRatePercentage') AS cart_item_total_tax_rate,\n\n    -- Selection (Arrays)\n    ARRAY_TO_STRING(JSON_VALUE_ARRAY(cart, '$.selection.selectedDiscountCodes'), ', ') AS cart_selected_discount_codes,\n    SAFE.JSON_VALUE(selected_product, '$.amount') AS cart_selected_product_amount,\n    REPLACE(SAFE.JSON_VALUE(selected_product, '$.productId'), \"Product:\", '') AS cart_selected_product_id,\n\n    -- Totals\n    SAFE.JSON_VALUE(cart, '$.totals.appliedDiscount.grossPrice') AS cart_applied_discount_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.appliedDiscount.netPrice') AS cart_applied_discount_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.appliedDiscount.taxRatePercentage') AS cart_applied_discount_tax_rate,\n    SAFE.JSON_VALUE(cart, '$.totals.appliedDiscountPercentage') AS cart_applied_discount_percentage,\n    SAFE.JSON_VALUE(cart, '$.totals.includingAllDiscounts.grossPrice') AS cart_including_all_discounts_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.includingAllDiscounts.netPrice') AS cart_including_all_discounts_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.includingAllDiscounts.taxRatePercentage') AS cart_including_all_discounts_tax_rate,\n\n    -- Monthly Options\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.downPayment.grossPrice') AS cart_monthly_downpayment_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.downPayment.netPrice') AS cart_monthly_downpayment_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.downPayment.taxRatePercentage') AS cart_monthly_downpayment_tax_rate,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.financedAmount.grossPrice') AS cart_monthly_financed_amount_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.financedAmount.netPrice') AS cart_monthly_financed_amount_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.financedAmount.taxRatePercentage') AS cart_monthly_financed_amount_tax_rate,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.monthlyRate.grossPrice') AS cart_monthly_rate_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.monthlyRate.netPrice') AS cart_monthly_rate_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.monthlyRate.taxRatePercentage') AS cart_monthly_rate_tax_rate,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.rateCount') AS cart_monthly_rate_count,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.totalAmount.grossPrice') AS cart_monthly_total_amount_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.totalAmount.netPrice') AS cart_monthly_total_amount_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.totalAmount.taxRatePercentage') AS cart_monthly_total_amount_tax_rate,\n\n    -- Without Discounts\n    SAFE.JSON_VALUE(cart, '$.totals.withoutDiscounts.grossPrice') AS cart_without_discounts_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.withoutDiscounts.netPrice') AS cart_without_discounts_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.withoutDiscounts.taxRatePercentage') AS cart_without_discounts_tax_rate\n  \n  FROM unnest_data \n  LEFT JOIN UNNEST(JSON_QUERY_ARRAY(cart, '$.items')) AS item\n  LEFT JOIN UNNEST(JSON_QUERY_ARRAY(cart, '$.selection.selectedProducts')) AS selected_product\n\n)\n\nSELECT * FROM unnest_cart_items", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`base_billing_orders`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:09:39.012619Z", "completed_at": "2025-05-13T23:09:39.020006Z"}, {"name": "execute", "started_at": "2025-05-13T23:09:39.020788Z", "completed_at": "2025-05-13T23:09:42.754910Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.744507312774658, "adapter_response": {"_message": "CREATE TABLE (39.0 rows, 10.0 KiB processed)", "code": "CREATE TABLE", "rows_affected": 39, "bytes_processed": 10220, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "eb38fb27-2618-438a-8ba3-f288628117b7", "slot_ms": 3402}, "message": "CREATE TABLE (39.0 rows, 10.0 KiB processed)", "failures": null, "unique_id": "model.key_academy.base_billing_products", "compiled": true, "compiled_code": "\n\nWITH license_base AS (\n    SELECT\n        _airbyte_raw_id AS airbyte_raw_id,\n        _airbyte_extracted_at AS airbyte_extracted_at,\n        JSON_QUERY(_airbyte_meta, '$') AS airbyte_meta,\n        _airbyte_generation_id AS airbyte_generation_id,\n        REPLACE(id, 'Product:', '') AS product_id, \n        _id AS id,\n        JSON_QUERY(data, '$') AS data,\n        title,\n        isHidden AS is_hidden,\n        netPrice AS net_price,\n        isTaxFree AS is_tax_free,\n        JSON_QUERY(extensions, '$') AS extensions,\n        JSON_QUERY(deletionInfo, '$') AS deletion_info,\n        _ab_cdc_cursor AS ab_cdc_cursor,\n        _ab_cdc_deleted_at AS ab_cdc_deleted_at,\n        _ab_cdc_updated_at AS ab_cdc_updated_at,\n    FROM `intrepid-craft-450709-f9`.`test_orders_copy`.`billing_products`  \n),\n\nunnest_data AS (\n    SELECT \n        airbyte_extracted_at,\n        airbyte_generation_id,\n        ab_cdc_deleted_at,\n        ab_cdc_updated_at,\n        airbyte_raw_id,\n        ab_cdc_cursor,\n        SAFE.JSON_VALUE(airbyte_meta, '$.changes') AS airbyte_changes, \n        SAFE.JSON_VALUE(airbyte_meta, '$.sync_id') AS airbyte_sync_id,\n        id,\n        product_id,\n        title,\n        is_hidden,\n        net_price,\n        is_tax_free,\n        SAFE.JSON_VALUE(data, '$.kind') AS license_kind, \n        REPLACE(SAFE.JSON_VALUE(data, '$.licenseDefinition'), \"LicenseDefinition:\",'') AS license_definition_id,\n        SAFE.JSON_VALUE(deletion_info, '$.isDeleted') AS is_deleted, \n        SAFE.JSON_VALUE(deletion_info, '$.kind') AS deletion_info,\n    FROM license_base\n)\n\nSELECT * FROM unnest_data", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`base_billing_products`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:09:42.762333Z", "completed_at": "2025-05-13T23:09:42.769629Z"}, {"name": "execute", "started_at": "2025-05-13T23:09:42.770817Z", "completed_at": "2025-05-13T23:09:46.134946Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.3752787113189697, "adapter_response": {"_message": "CREATE TABLE (1.4k rows, 501.7 KiB processed)", "code": "CREATE TABLE", "rows_affected": 1357, "bytes_processed": 513726, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "23e84fc0-f968-4d6a-98c2-e6163f3b4c26", "slot_ms": 3665}, "message": "CREATE TABLE (1.4k rows, 501.7 KiB processed)", "failures": null, "unique_id": "model.key_academy.base_learn_ihk_certificate_orders", "compiled": true, "compiled_code": "\n\n\n\nWITH raw_certificate_base AS (\n    SELECT\n        _airbyte_raw_id AS airbyte_raw_id,\n        _airbyte_extracted_at AS airbyte_extracted_at,\n        JSON_QUERY(_airbyte_meta, '$') AS airbyte_meta,\n        _airbyte_generation_id AS airbyte_generation_id,\n        REPLACE(id, 'IHKCertificateOrder:', '') AS certificate_id, \n        kind,\n        JSON_QUERY(userData, '$') AS user_data,\n        JSON_QUERY(initialData, '$') AS initial_data,\n        JSON_QUERY(deletionInfo, '$') AS deletion_info,\n        JSON_QUERY(certificateData, '$') AS certificate_data,\n        _ab_cdc_cursor AS ab_cdc_cursor,\n        _ab_cdc_deleted_at AS ab_cdc_deleted_at,\n        _ab_cdc_updated_at AS ab_cdc_updated_at,\n    FROM `intrepid-craft-450709-f9`.`test_orders_copy`.`learn_ihk_certificate_orders`  \n),\n\nunnest_data AS (\n    SELECT\n        airbyte_extracted_at,\n        airbyte_generation_id,\n        ab_cdc_deleted_at,\n        ab_cdc_updated_at,      \n        airbyte_raw_id,\n        ab_cdc_cursor,\n        certificate_id,\n        kind AS certificate_kind,\n        SAFE.JSON_VALUE(initial_data, '$.canOrderAt') AS can_order_at,\n        REPLACE(SAFE.JSON_VALUE(initial_data, '$.recipientId'), 'User:', '') AS recipient_id,\n        ROUND(CAST(SAFE.JSON_VALUE(initial_data, '$.performanceInPercent') AS FLOAT64), 2) AS performance_in_percent,\n        REPLACE(SAFE.JSON_VALUE(initial_data, '$.receivedInContentId'), 'Node:', '') AS received_in_node_id,\n        REPLACE(SAFE.JSON_VALUE(initial_data, '$.receivedInRootId'), 'Node:', '') AS received_in_root_node_id,\n        SAFE.JSON_VALUE(initial_data, '$.isWithHonors') AS is_with_honors,\n        SAFE.JSON_VALUE(deletion_info, '$.isDeleted') AS is_deleted,\n        SAFE.JSON_VALUE(deletion_info, '$.kind') AS deletion_kind,\n        SAFE.JSON_VALUE(certificate_data, '$.orderedAt') AS ordered_at,\n        SAFE.JSON_VALUE(certificate_data, '$.verificationNumber') AS verification_number,\n    FROM raw_certificate_base\n)\n\nSELECT * FROM unnest_data", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`base_learn_ihk_certificate_orders`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:09:46.141585Z", "completed_at": "2025-05-13T23:09:46.148663Z"}, {"name": "execute", "started_at": "2025-05-13T23:09:46.149575Z", "completed_at": "2025-05-13T23:09:50.723834Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 4.583751678466797, "adapter_response": {"_message": "CREATE TABLE (98.0k rows, 28.7 MiB processed)", "code": "CREATE TABLE", "rows_affected": 98011, "bytes_processed": 30053225, "bytes_billed": 30408704, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "5d47a5b3-7361-4ed4-b9a8-1a9bdd53f33c", "slot_ms": 9153}, "message": "CREATE TABLE (98.0k rows, 28.7 MiB processed)", "failures": null, "unique_id": "model.key_academy.base_learn_tree_states", "compiled": true, "compiled_code": "\n\nWITH learn_tree_states_base AS (\n    SELECT\n        _airbyte_raw_id AS airbyte_raw_id,\n        _airbyte_extracted_at AS airbyte_extracted_at,\n        JSON_QUERY(_airbyte_meta, '$') AS airbyte_meta,\n        _airbyte_generation_id AS airbyte_generation_id,\n        REPLACE(id, 'TreeState:', '') AS tree_state_id, \n        REPLACE(userId, 'User:', '') AS user_id, \n        _id AS id,\n        startedAt AS started_at,\n        JSON_QUERY(definition, '$') AS definition,\n        REPLACE(rootNodeId, 'Node:', '') AS root_node_id,\n        _ab_cdc_cursor AS ab_cdc_cursor,\n        _ab_cdc_deleted_at AS ab_cdc_deleted_at,\n        _ab_cdc_updated_at AS ab_cdc_updated_at,\n    FROM `intrepid-craft-450709-f9`.`test_orders_copy`.`learn_tree_states`   \n),\n\nunnest_data AS (\n    SELECT\n        airbyte_extracted_at,\n        airbyte_generation_id,\n        ab_cdc_deleted_at,\n        ab_cdc_updated_at,\n        airbyte_raw_id,\n        ab_cdc_cursor,\n        SAFE.JSON_VALUE(airbyte_meta, '$.changes') AS airbyte_changes, \n        SAFE.JSON_VALUE(airbyte_meta, '$.sync_id') AS airbyte_sync_id, \n        started_at,\n        user_id, \n        root_node_id,\n        tree_state_id, \n        REPLACE(CAST(SAFE.JSON_VALUE(definition, '$.headContentNodeId') AS STRING), 'Node:', '') AS head_content_node_id,\n        SAFE.JSON_VALUE(definition, '$.status') AS status        \n    FROM learn_tree_states_base\n)\n\nSELECT * FROM unnest_data", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`base_learn_tree_states`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:09:50.729240Z", "completed_at": "2025-05-13T23:09:50.734395Z"}, {"name": "execute", "started_at": "2025-05-13T23:09:50.735334Z", "completed_at": "2025-05-13T23:09:58.151618Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 7.423643589019775, "adapter_response": {"_message": "CREATE TABLE (43.0k rows, 13.9 MiB processed)", "code": "CREATE TABLE", "rows_affected": 43014, "bytes_processed": 14548172, "bytes_billed": 14680064, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "2a4545e2-093b-487c-8ad8-3cf33bb329f2", "slot_ms": 6692}, "message": "CREATE TABLE (43.0k rows, 13.9 MiB processed)", "failures": null, "unique_id": "model.key_academy.base_learn_tree_unlocked_states", "compiled": true, "compiled_code": "\n\nWITH learn_tree_unlocked_states_base AS (\n    SELECT\n        _airbyte_raw_id AS airbyte_raw_id,\n        _airbyte_extracted_at AS airbyte_extracted_at,\n        JSON_QUERY(_airbyte_meta, '$') AS airbyte_meta,\n        _airbyte_generation_id AS airbyte_generation_id,\n        REPLACE(id, 'TreeUnlockedState:', '') AS tree_unlocked_state_id, \n        _id AS id,\n        JSON_QUERY(data, '$') AS data,\n        lt.when AS tree_unlocked_state_datetimestamp,\n        REPLACE(rootId, 'Node:', '') AS root_node_id,\n        REPLACE(userId, 'User:', '') AS user_id, \n        _ab_cdc_cursor AS ab_cdc_cursor,\n        _ab_cdc_deleted_at AS ab_cdc_deleted_at,\n        _ab_cdc_updated_at AS ab_cdc_updated_at,        \n    FROM `intrepid-craft-450709-f9`.`test_orders_copy`.`learn_tree_unlocked_states` AS lt\n),\n\nunnest_data AS (\n    SELECT\n        airbyte_extracted_at,\n        airbyte_generation_id,\n        ab_cdc_deleted_at,\n        ab_cdc_updated_at,      \n        airbyte_raw_id,\n        ab_cdc_cursor,\n        SAFE.JSON_VALUE(airbyte_meta, '$.changes') AS airbyte_changes, \n        SAFE.JSON_VALUE(airbyte_meta, '$.sync_id') AS airbyte_sync_id, \n        tree_unlocked_state_datetimestamp,\n        id,\n        tree_unlocked_state_id, \n        user_id, \n        root_node_id,\n        SAFE.JSON_VALUE(data, '$.kind') AS learn_tree_unlocked_kind, \n        REPLACE(SAFE.JSON_VALUE(data, '$.licenseId'), \"License:\", '') AS license_id\n    FROM learn_tree_unlocked_states_base\n)\n\nSELECT * FROM unnest_data", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`base_learn_tree_unlocked_states`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:09:58.158794Z", "completed_at": "2025-05-13T23:09:58.163388Z"}, {"name": "execute", "started_at": "2025-05-13T23:09:58.164270Z", "completed_at": "2025-05-13T23:10:01.575341Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.417926549911499, "adapter_response": {"_message": "CREATE TABLE (2.9k rows, 3.8 MiB processed)", "code": "CREATE TABLE", "rows_affected": 2886, "bytes_processed": 3942127, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "4f10da6d-505b-4cfc-88e2-260b20a79e14", "slot_ms": 3474}, "message": "CREATE TABLE (2.9k rows, 3.8 MiB processed)", "failures": null, "unique_id": "model.key_academy.base_trees_published_nodes", "compiled": true, "compiled_code": "\n\nWITH trees_published_nodes_base AS (\n    SELECT\n        _airbyte_raw_id AS airbyte_raw_id,\n        _airbyte_extracted_at AS airbyte_extracted_at,\n        JSON_QUERY(_airbyte_meta, '$') AS airbyte_meta,\n        _airbyte_generation_id AS airbyte_generation_id,\n        REPLACE(id, 'Node:', '') AS node_id, \n        _id AS id,\n        REPLACE(imageRef, 'FileDescription:', '') as file_description_id,\n        JSON_QUERY(versioning, '$') AS versioning,\n        JSON_QUERY(attachments, '$') AS attachments,\n        JSON_QUERY(deletionInfo, '$') AS deletion_info,\n        JSON_QUERY(instructorIds, '$') AS instructor_ids,\n        JSON_QUERY(typeDefinition, '$') AS type_definition,\n        JSON_QUERY(releaseCoordinates, '$') AS release_coordinates,\n        JSON_QUERY(structureDefinition, '$') AS structure_definition,\n        _ab_cdc_cursor AS ab_cdc_cursor,\n        _ab_cdc_deleted_at AS ab_cdc_deleted_at,\n        _ab_cdc_updated_at AS ab_cdc_updated_at,\n    FROM `intrepid-craft-450709-f9`.`test_orders_copy`.`trees_published_nodes`  \n),\n\n--not done\nunnest_data AS (\n    SELECT\n        airbyte_extracted_at,\n        airbyte_generation_id,\n        ab_cdc_deleted_at,\n        ab_cdc_updated_at,      \n        airbyte_raw_id,\n        ab_cdc_cursor,\n        file_description_id,\n        id,\n        node_id,\n        SAFE.JSON_VALUE(attachments, '$.fileId') AS file_id,\n        SAFE.JSON_VALUE(attachments, '$.id') AS attachment_id,\n        SAFE.JSON_VALUE(attachments, '$.kind') AS file_kind,\n        SAFE.JSON_VALUE(attachments, '$.title') AS file_title,\n        SAFE.JSON_VALUE(versioning, '$.draftVersion') AS draft_version,\n        SAFE.JSON_VALUE(versioning, '$.releaseVersion') AS release_version,\n        REGEXP_REPLACE(REGEXP_REPLACE(TO_JSON_STRING(instructor_ids),r'\"Instructor:([^\"]+)\"',r'\\1'),r'[\\[\\]\"]','') AS instructor_ids,\n        REGEXP_REPLACE(REGEXP_REPLACE(TO_JSON_STRING(type_definition['childRefs']),r'\"Node:([^\"]+)\"',r'\\1'),  r'[\\[\\]\"]','') AS all_child_refs_flat,\n        SAFE.JSON_VALUE(type_definition, '$.definitionType') AS definition_type,\n        SAFE.JSON_VALUE(type_definition, '$.contentKind') AS content_kind,\n        SAFE.JSON_VALUE(type_definition, '$.continueConfig.configType') AS continue_config_type,\n        REPLACE(SAFE.JSON_VALUE(type_definition, '$.continueConfig.id'), 'ContinueContentConfig:', '') AS continue_config_id,\n        SAFE.JSON_VALUE(type_definition, '$.flowConfig.configType') AS flow_config_type,\n        REPLACE(SAFE.JSON_VALUE(type_definition, '$.flowConfig.id'), 'FlowELearningContentConfig:', '') AS flow_config_id,\n        SAFE.JSON_VALUE(type_definition, '$.flowConfig.minNumTriesTillShowAnswer') AS min_tries_show_answer,\n        SAFE.JSON_VALUE(type_definition, '$.passConfig.configType') AS pass_config_type,\n        REPLACE(SAFE.JSON_VALUE(type_definition, '$.passConfig.id'), 'PassContentConfig:', '') AS pass_config_id,\n        SAFE.JSON_VALUE(type_definition, '$.restartIfPassedConfig.configType') AS restart_if_passed_type,\n        REPLACE(SAFE.JSON_VALUE(type_definition, '$.restartIfPassedConfig.id'), 'RestartIfPassedContentConfig:', '') AS restart_if_passed_id,\n        REGEXP_REPLACE(REGEXP_REPLACE(TO_JSON_STRING(SAFE.JSON_EXTRACT(type_definition, '$.rewardTypeConfigs')), r'\\{\"id\":\"Reward:[^\"]+\",\"kind\":\"([^\"]+)\"\\}', r'\\1'), r'[\\[\\]\"]', '') AS reward_type_kinds,\n\n        REPLACE(SAFE.JSON_VALUE(type_definition, '$.rewardConfig.id'), 'RewardContentConfig:', '') AS reward_config_id,\n        REGEXP_REPLACE(REGEXP_REPLACE(TO_JSON_STRING(type_definition['elementRefs']),r'\"Element:([^\"]+)\"',r'\\1'),  r'[\\[\\]\"]','') AS element_refs,        \n        SAFE.JSON_VALUE(release_coordinates, '$.next_content_node_id') AS next_content_node_id,\n        SAFE.JSON_VALUE(release_coordinates, '$.previous_content_node_id') AS previous_content_node_id,\n        REGEXP_REPLACE(REGEXP_REPLACE(TO_JSON_STRING(SAFE.JSON_VALUE(type_definition, '$.rewardTypeConfigs')), r'\"Reward:([^\"]+)\"', r'\\1'), r'[\\[\\]\"]', '') AS reward_type_ids,\n        \n        SAFE.JSON_VALUE(structure_definition, '$.structureType') AS structure_type,\n        SAFE.JSON_VALUE(structure_definition, '$.title') AS title,\n\n        -- coordinates.*\n        SAFE.JSON_VALUE(structure_definition, '$.coordinates.nextSiblingRef') AS next_sibling_ref,\n        SAFE.JSON_VALUE(structure_definition, '$.coordinates.previousSiblingRef') AS previous_sibling_ref,\n\n        -- Flattening array values from coordinates\n        REGEXP_REPLACE(REGEXP_REPLACE(TO_JSON_STRING(SAFE.JSON_EXTRACT(structure_definition, '$.coordinates.indexPath')), r'[\\[\\]\"]', ''), r',', '-') AS index_path, -- returns \"0-2\"\n        REGEXP_REPLACE(REGEXP_REPLACE(TO_JSON_STRING(SAFE.JSON_EXTRACT(structure_definition, '$.coordinates.pathRefs')), r'\"Node:([^\"]+)\"', r'\\1'), r'[\\[\\]\"]', '') AS path_refs,\n\n        SAFE.JSON_VALUE(deletion_info, '$.isDeleted') AS is_deleted,\n        SAFE.JSON_VALUE(deletion_info, '$.kind') AS deletion_kind\n    FROM trees_published_nodes_base\n)\n\nSELECT * FROM unnest_data", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`base_trees_published_nodes`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:01.580433Z", "completed_at": "2025-05-13T23:10:01.584173Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:01.585009Z", "completed_at": "2025-05-13T23:10:05.874605Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 4.295541286468506, "adapter_response": {"_message": "CREATE TABLE (207.9k rows, 10.3 MiB processed)", "code": "CREATE TABLE", "rows_affected": 207896, "bytes_processed": 10791447, "bytes_billed": 11534336, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "e08a8f57-77ec-4e52-b4db-a61af61e610b", "slot_ms": 7161}, "message": "CREATE TABLE (207.9k rows, 10.3 MiB processed)", "failures": null, "unique_id": "model.key_academy.mart_user_segments", "compiled": true, "compiled_code": "\n\nWITH user_info AS (\n    SELECT \n        user_id,\n        company_type,\n        COALESCE(business_kind, 'Unknown') AS business_kind,\n        CASE\n            WHEN DATE_DIFF(CURRENT_DATE(), DATE(customer_date_of_birth), YEAR) < 29 THEN '<29'\n            WHEN DATE_DIFF(CURRENT_DATE(), DATE(customer_date_of_birth), YEAR) BETWEEN 30 AND 39 THEN '30-39'\n            WHEN DATE_DIFF(CURRENT_DATE(), DATE(customer_date_of_birth), YEAR) BETWEEN 40 AND 49 THEN '40-49'\n            WHEN DATE_DIFF(CURRENT_DATE(), DATE(customer_date_of_birth), YEAR) >= 50 THEN '50+'\n            ELSE 'Unknown'\n        END AS age_bucket\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`base_billing_orders`\n)\n\nSELECT * FROM user_info", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`mart_user_segments`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:05.879450Z", "completed_at": "2025-05-13T23:10:05.883662Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:05.885344Z", "completed_at": "2025-05-13T23:10:09.028408Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.150447130203247, "adapter_response": {"_message": "CREATE TABLE (39.0 rows, 5.7 KiB processed)", "code": "CREATE TABLE", "rows_affected": 39, "bytes_processed": 5848, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "935b45e8-c5fa-44cb-bbac-6626751de559", "slot_ms": 4876}, "message": "CREATE TABLE (39.0 rows, 5.7 KiB processed)", "failures": null, "unique_id": "model.key_academy.stg_billing_products", "compiled": true, "compiled_code": "\n\nWITH base_billing_products AS (\n    SELECT\n        id,\n        product_id,\n        title AS product_title,\n        is_hidden,\n        net_price,\n        is_tax_free,\n        license_kind,\n        is_deleted\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`base_billing_products`   \n)\n\nSELECT * FROM base_billing_products", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`stg_billing_products`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:09.034218Z", "completed_at": "2025-05-13T23:10:09.038166Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:09.039127Z", "completed_at": "2025-05-13T23:10:12.362531Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.330054521560669, "adapter_response": {"_message": "CREATE TABLE (1.4k rows, 345.8 KiB processed)", "code": "CREATE TABLE", "rows_affected": 1357, "bytes_processed": 354091, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "a1d99d70-762a-45be-9e28-d36cdfcf2f49", "slot_ms": 3789}, "message": "CREATE TABLE (1.4k rows, 345.8 KiB processed)", "failures": null, "unique_id": "model.key_academy.stg_learn_ihk_certificate_orders", "compiled": true, "compiled_code": "\n\nWITH certificate_base AS (\n    SELECT\n        can_order_at,\n        ordered_at,\n        certificate_id,\n        verification_number,\n        certificate_kind,\n        recipient_id,\n        performance_in_percent,\n        received_in_node_id,\n        received_in_root_node_id,\n        is_with_honors,\n        is_deleted,\n        deletion_kind\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`base_learn_ihk_certificate_orders`   \n)\n\nSELECT * FROM certificate_base", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`stg_learn_ihk_certificate_orders`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:12.370031Z", "completed_at": "2025-05-13T23:10:12.377761Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:12.378682Z", "completed_at": "2025-05-13T23:10:16.637416Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 4.269589424133301, "adapter_response": {"_message": "CREATE TABLE (98.0k rows, 16.9 MiB processed)", "code": "CREATE TABLE", "rows_affected": 98011, "bytes_processed": 17691828, "bytes_billed": 17825792, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "39fe3220-c483-4f32-94c4-d796ac1338b0", "slot_ms": 6989}, "message": "CREATE TABLE (98.0k rows, 16.9 MiB processed)", "failures": null, "unique_id": "model.key_academy.stg_learn_tree_states", "compiled": true, "compiled_code": "\n\nWITH base_learn_tree_states AS (\n    SELECT\n        started_at,\n        user_id,\n        root_node_id,\n        tree_state_id,\n        head_content_node_id,\n        status\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`base_learn_tree_states`   \n)\n\nSELECT * FROM base_learn_tree_states", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`stg_learn_tree_states`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:16.643775Z", "completed_at": "2025-05-13T23:10:16.652243Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:16.653335Z", "completed_at": "2025-05-13T23:10:20.552946Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.911146879196167, "adapter_response": {"_message": "CREATE TABLE (43.0k rows, 8.4 MiB processed)", "code": "CREATE TABLE", "rows_affected": 43014, "bytes_processed": 8775562, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "f7e57372-c4b9-4197-bfb3-ba35b81fb03a", "slot_ms": 5333}, "message": "CREATE TABLE (43.0k rows, 8.4 MiB processed)", "failures": null, "unique_id": "model.key_academy.stg_learn_tree_unlocked_states", "compiled": true, "compiled_code": "\n\nWITH base_learn_tree_unlocked_states AS (\n    SELECT\n        tree_unlocked_state_datetimestamp,\n        id,\n        tree_unlocked_state_id,\n        user_id,\n        root_node_id,\n        learn_tree_unlocked_kind,\n        license_id\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`base_learn_tree_unlocked_states`   \n)\n\nSELECT * FROM base_learn_tree_unlocked_states", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`stg_learn_tree_unlocked_states`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:20.558266Z", "completed_at": "2025-05-13T23:10:20.562002Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:20.563038Z", "completed_at": "2025-05-13T23:10:24.057909Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.501434326171875, "adapter_response": {"_message": "CREATE TABLE (2.9k rows, 2.3 MiB processed)", "code": "CREATE TABLE", "rows_affected": 2886, "bytes_processed": 2433291, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "249b844e-69d0-4efd-ad63-bcec93265045", "slot_ms": 5597}, "message": "CREATE TABLE (2.9k rows, 2.3 MiB processed)", "failures": null, "unique_id": "model.key_academy.stg_trees_published_nodes", "compiled": true, "compiled_code": "\n\nWITH base_trees_published_nodes AS (\n    SELECT\n        id,\n        node_id,\n        file_id,\n        attachment_id,\n        file_kind,\n        file_title,\n        draft_version,\n        release_version,\n        instructor_ids,\n        all_child_refs_flat AS all_child,\n        definition_type,\n        content_kind,\n        continue_config_type,\n        continue_config_id,\n        flow_config_type,\n        flow_config_id,\n        min_tries_show_answer,\n        pass_config_type,\n        pass_config_id,\n        restart_if_passed_type,\n        restart_if_passed_id,\n        reward_type_kinds,\n        reward_config_id,\n        element_refs,\n        next_content_node_id,\n        previous_content_node_id,\n        reward_type_ids,\n        structure_type,\n        title,\n        next_sibling_ref,\n        previous_sibling_ref,\n        index_path,\n        path_refs,\n        is_deleted,\n        deletion_kind\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`base_trees_published_nodes`   \n)\n\nSELECT * FROM base_trees_published_nodes", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`stg_trees_published_nodes`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:24.064549Z", "completed_at": "2025-05-13T23:10:24.069880Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:24.070711Z", "completed_at": "2025-05-13T23:10:27.297445Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.2349231243133545, "adapter_response": {"_message": "CREATE TABLE (1.4k rows, 345.8 KiB processed)", "code": "CREATE TABLE", "rows_affected": 1357, "bytes_processed": 354091, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "93330601-799c-48e0-9a0e-31f0b271dffa", "slot_ms": 3501}, "message": "CREATE TABLE (1.4k rows, 345.8 KiB processed)", "failures": null, "unique_id": "model.key_academy.mart_learn_ihk_certificate_orders", "compiled": true, "compiled_code": "\n\nSELECT * FROM `intrepid-craft-450709-f9`.`key_academy`.`stg_learn_ihk_certificate_orders`", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`mart_learn_ihk_certificate_orders`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:27.302057Z", "completed_at": "2025-05-13T23:10:27.305054Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:27.305861Z", "completed_at": "2025-05-13T23:10:34.590786Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 7.289926528930664, "adapter_response": {"_message": "CREATE TABLE (98.0k rows, 16.9 MiB processed)", "code": "CREATE TABLE", "rows_affected": 98011, "bytes_processed": 17691828, "bytes_billed": 17825792, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "f4f1ccd9-bb0f-465d-b2be-1cfeeee8d1fc", "slot_ms": 6834}, "message": "CREATE TABLE (98.0k rows, 16.9 MiB processed)", "failures": null, "unique_id": "model.key_academy.mart_learn_tree_states", "compiled": true, "compiled_code": "\n\nSELECT * FROM `intrepid-craft-450709-f9`.`key_academy`.`stg_learn_tree_states`", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`mart_learn_tree_states`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:34.595913Z", "completed_at": "2025-05-13T23:10:34.598926Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:34.599498Z", "completed_at": "2025-05-13T23:10:38.489901Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.8960723876953125, "adapter_response": {"_message": "CREATE TABLE (43.0k rows, 8.4 MiB processed)", "code": "CREATE TABLE", "rows_affected": 43014, "bytes_processed": 8775562, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "2377e087-b976-4856-b890-de3a5fdd98db", "slot_ms": 4711}, "message": "CREATE TABLE (43.0k rows, 8.4 MiB processed)", "failures": null, "unique_id": "model.key_academy.mart_learn_tree_unlocked_states", "compiled": true, "compiled_code": "\n\nSELECT * FROM `intrepid-craft-450709-f9`.`key_academy`.`stg_learn_tree_unlocked_states`", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`mart_learn_tree_unlocked_states`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:38.504777Z", "completed_at": "2025-05-13T23:10:38.511845Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:38.514826Z", "completed_at": "2025-05-13T23:10:41.767997Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 3.2661993503570557, "adapter_response": {"_message": "CREATE TABLE (2.9k rows, 2.3 MiB processed)", "code": "CREATE TABLE", "rows_affected": 2886, "bytes_processed": 2433291, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "5526b9fc-68aa-485f-a174-acfe9e9bc2d3", "slot_ms": 3541}, "message": "CREATE TABLE (2.9k rows, 2.3 MiB processed)", "failures": null, "unique_id": "model.key_academy.mart_trees_published_nodes", "compiled": true, "compiled_code": "\n\nSELECT * FROM `intrepid-craft-450709-f9`.`key_academy`.`stg_trees_published_nodes`", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`mart_trees_published_nodes`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:41.779166Z", "completed_at": "2025-05-13T23:10:41.789340Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:41.790460Z", "completed_at": "2025-05-13T23:10:47.572638Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 5.796430587768555, "adapter_response": {"_message": "CREATE TABLE (157.4k rows, 19.5 MiB processed)", "code": "CREATE TABLE", "rows_affected": 157394, "bytes_processed": 20443162, "bytes_billed": 52428800, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "0a014b81-d98b-489e-8d4c-a84cbe6f50b9", "slot_ms": 9110}, "message": "CREATE TABLE (157.4k rows, 19.5 MiB processed)", "failures": null, "unique_id": "model.key_academy.mart_user_module_progress", "compiled": true, "compiled_code": "\n\nWITH modules AS (\n    SELECT \n        node_id AS module_id,\n        title AS module_title\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`mart_trees_published_nodes`\n    WHERE structure_type != 'Root'\n),\n\ncourses AS (\n    SELECT \n        node_id AS root_node_id,\n        title AS course_title\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`mart_trees_published_nodes`\n    WHERE structure_type = 'Root'\n),\n\nlearn_tree_states AS (\n    SELECT\n        user_id,\n        root_node_id,\n        head_content_node_id AS module_id,\n        started_at AS module_started_at,\n        status AS module_progress_status\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`mart_learn_tree_states`\n),\n\nmodule_unlocks AS (\n    SELECT\n        user_id,\n        root_node_id,\n        tree_unlocked_state_datetimestamp AS module_unlocked_at,\n        learn_tree_unlocked_kind,\n        license_id\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`mart_learn_tree_unlocked_states`\n),\n\nrevenue_info AS (\n    SELECT\n        product_title AS course_title,\n        net_price\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`stg_billing_products`\n),\n\ncertificates AS (\n    SELECT\n        recipient_id AS user_id,\n        ordered_at AS certificate_completed_at,\n        certificate_id,\n        verification_number,\n        received_in_root_node_id AS root_node_id,\n        received_in_node_id AS module_id,\n        is_with_honors,\n        performance_in_percent\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`mart_learn_ihk_certificate_orders`\n)\n\nSELECT\n    ts.user_id,\n    ts.root_node_id,\n    c.course_title,\n    ts.module_id,\n    m.module_title,\n    ts.module_started_at,\n    ts.module_progress_status,\n    mu.module_unlocked_at,\n    mu.learn_tree_unlocked_kind,\n    cr.certificate_completed_at,\n    cr.certificate_id,\n    cr.verification_number,\n    cr.is_with_honors,\n    cr.performance_in_percent,\n    mu.license_id,\n    CASE \n        WHEN mu.license_id IS NOT NULL THEN ri.net_price \n        ELSE NULL \n    END AS net_price\nFROM learn_tree_states ts\nLEFT JOIN module_unlocks mu \n    ON ts.user_id = mu.user_id \n    AND ts.root_node_id = mu.root_node_id\nLEFT JOIN modules m \n    ON ts.module_id = m.module_id\nLEFT JOIN courses c \n    ON ts.root_node_id = c.root_node_id\nLEFT JOIN certificates cr \n    ON cr.user_id = ts.user_id \n    AND cr.root_node_id = ts.root_node_id \nLEFT JOIN revenue_info ri \n    ON c.course_title = ri.course_title", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`mart_user_module_progress`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T23:10:47.582416Z", "completed_at": "2025-05-13T23:10:47.592061Z"}, {"name": "execute", "started_at": "2025-05-13T23:10:47.593065Z", "completed_at": "2025-05-13T23:10:53.498168Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 5.9182960987091064, "adapter_response": {"_message": "CREATE TABLE (716.1k rows, 23.6 MiB processed)", "code": "CREATE TABLE", "rows_affected": 716134, "bytes_processed": 24704612, "bytes_billed": 25165824, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "6a0fa62d-f2ae-42c1-a31a-7b14acdb11f8", "slot_ms": 13840}, "message": "CREATE TABLE (716.1k rows, 23.6 MiB processed)", "failures": null, "unique_id": "model.key_academy.mart_agg_user_segments", "compiled": true, "compiled_code": "\n\nWITH user_info AS (\n    SELECT\n        user_id,\n        COALESCE(CONCAT(business_kind || ' - ' || age_bucket), 'Unknown') AS segments\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`mart_user_segments`\n),\n\nuser_module_progress AS (\n    SELECT\n        user_id,\n        DATE(module_started_at) AS module_started_date,\n        SUM(CASE WHEN module_started_at IS NOT NULL AND module_unlocked_at IS NULL THEN 1 ELSE 0 END) AS trials,\n        COUNTIF(module_progress_status = 'Started') AS courses_started,\n        COUNTIF(module_progress_status = 'Finished') AS lessons_completed,\n        SUM(CASE WHEN certificate_id IS NOT NULL THEN 1 ELSE 0 END) AS certificates,\n        SUM(CASE WHEN license_id IS NOT NULL THEN 1 ELSE 0 END) AS licenses,\n        SUM(net_price) AS revenue\n    FROM `intrepid-craft-450709-f9`.`key_academy`.`mart_user_module_progress`\n    GROUP BY ALL\n),\n\nsummary AS (\n    SELECT\n        mod.user_id,\n        user.segments,\n        mod.module_started_date,\n        mod.trials,\n        mod.courses_started,\n        mod.lessons_completed,\n        mod.certificates,\n        mod.licenses,\n        mod.revenue\n    FROM user_module_progress mod\n    FULL JOIN user_info user USING (user_id)\n)\n\nSELECT * FROM summary", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`mart_agg_user_segments`", "batch_results": null}], "elapsed_time": 86.38425397872925, "args": {"source_freshness_run_project_hooks": false, "favor_state": false, "write_json": true, "project_dir": "/home/jddeguia/key-academy/key_academy", "print": true, "empty": false, "full_refresh": true, "indirect_selection": "eager", "warn_error_options": {"include": [], "exclude": []}, "defer": false, "log_path": "/home/jddeguia/key-academy/key_academy/logs", "require_explicit_package_overrides_for_builtin_materializations": true, "require_nested_cumulative_type_params": false, "profiles_dir": "/home/jddeguia/.dbt", "require_resource_names_without_spaces": false, "send_anonymous_usage_stats": true, "show_resource_report": false, "cache_selected_only": false, "state_modified_compare_more_unrendered_values": false, "introspect": true, "populate_cache": true, "require_batched_execution_for_custom_microbatch_strategy": false, "which": "run", "use_colors": true, "invocation_command": "dbt run -s +mart_agg_user_segments --full-refresh", "require_yaml_configuration_for_mf_time_spines": false, "partial_parse_file_diff": true, "select": ["+mart_agg_user_segments"], "log_level_file": "debug", "strict_mode": false, "log_format_file": "debug", "state_modified_compare_vars": false, "log_format": "default", "log_level": "info", "version_check": true, "log_file_max_bytes": 10485760, "macro_debugging": false, "vars": {}, "printer_width": 80, "use_colors_file": true, "exclude": [], "quiet": false, "skip_nodes_if_on_run_start_fails": false, "static_parser": true, "partial_parse": true}}