{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.3", "generated_at": "2025-05-13T14:31:22.570213Z", "invocation_id": "df6de864-60a2-4a58-97a3-91c86fe04261", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T14:30:21.561733Z", "completed_at": "2025-05-13T14:30:21.583701Z"}, {"name": "execute", "started_at": "2025-05-13T14:30:21.584947Z", "completed_at": "2025-05-13T14:30:34.804478Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 13.247217655181885, "adapter_response": {"_message": "CREATE TABLE (207.9k rows, 54.1 MiB processed)", "code": "CREATE TABLE", "rows_affected": 207896, "bytes_processed": 56778159, "bytes_billed": 57671680, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "0d6815e2-a1c2-487f-9a4a-c08da63dfc39", "slot_ms": 20425}, "message": "CREATE TABLE (207.9k rows, 54.1 MiB processed)", "failures": null, "unique_id": "model.key_academy.base_billing_orders", "compiled": true, "compiled_code": "\n\nWITH billing_orders_base AS (\n  SELECT \n    _airbyte_raw_id AS airbyte_raw_id,\n    _airbyte_extracted_at AS airbyte_extracted_at,\n    JSON_QUERY(_airbyte_meta, '$') AS airbyte_meta,\n    _airbyte_generation_id AS airbyte_generation_id,\n    REPLACE(id, 'Order:', '') AS order_id,  \n    _id AS id,\n    JSON_QUERY(acl, '$') AS acl,\n    JSON_QUERY(cart, '$') AS cart,\n    status AS billing_order_status,\n    createdAt AS created_at,\n    JSON_QUERY(purchaser, '$') AS purchaser,\n    JSON_QUERY(invoiceData, '$') AS invoice_data,\n    JSON_QUERY(paymentData, '$') AS payment_data,\n    JSON_QUERY(deletionInfo, '$') AS deletion_info,\n    _ab_cdc_cursor AS ab_cdc_cursor,\n    JSON_QUERY(customerDetails, '$') AS customer_details,\n    _ab_cdc_deleted_at AS ab_cdc_deleted_at,\n    _ab_cdc_updated_at AS ab_cdc_updated_at,\n    JSON_QUERY(allowedPaymentMethods, '$') AS allowed_payment_methods,\n    JSON_QUERY(selectedPaymentMethod, '$') AS selected_payment_method,\n  FROM `intrepid-craft-450709-f9`.`test_orders_copy`.`billing_orders`\n),\n\nunnest_data AS (\n  SELECT\n    airbyte_extracted_at,\n    airbyte_generation_id,\n    ab_cdc_deleted_at,\n    ab_cdc_updated_at,\n    airbyte_raw_id,\n    ab_cdc_cursor,\n    SAFE.JSON_VALUE(airbyte_meta, '$.changes') AS airbyte_changes, \n    SAFE.JSON_VALUE(airbyte_meta, '$.sync_id') AS airbyte_sync_id,\n    order_id,  \n    id,\n    created_at,\n    billing_order_status,\n    cart,\n    REPLACE(SAFE.JSON_VALUE(purchaser, '$.accountId'), \"Account:\", '') AS account_id,\n    REPLACE(SAFE.JSON_VALUE(purchaser, '$.userId'), \"User:\", '') AS user_id,\n    SAFE.JSON_VALUE(customer_details, '$.city') AS customer_city,\n    SAFE.JSON_VALUE(customer_details, '$.country') AS customer_country,\n    SAFE.JSON_VALUE(customer_details, '$.firstName') AS customer_first_name,\n    SAFE.JSON_VALUE(customer_details, '$.lastName') AS customer_last_name,\n    SAFE.JSON_VALUE(customer_details, '$.houseNumber') AS customer_house_number,\n    SAFE.JSON_VALUE(customer_details, '$.invoiceEmail') AS customer_invoice_email,\n    SAFE.JSON_VALUE(customer_details, '$.phoneNumber') AS customer_phone_number,\n    SAFE.JSON_VALUE(customer_details, '$.postalCode') AS customer_postal_code,\n    SAFE.JSON_VALUE(customer_details, '$.salutation') AS customer_salutation,\n    SAFE.JSON_VALUE(customer_details, '$.street') AS customer_street,\n    SAFE.JSON_VALUE(customer_details, '$.data.dateOfBirth') AS customer_date_of_birth,\n    SAFE.JSON_VALUE(customer_details, '$.data.company') AS customer_company,\n    SAFE.JSON_VALUE(customer_details, '$.data.companyDetails') AS company_details,\n    SAFE.JSON_VALUE(customer_details, '$.data.companyType') AS company_type,\n    SAFE.JSON_VALUE(customer_details, '$.data.kind') AS business_kind,\n    ARRAY_TO_STRING(JSON_VALUE_ARRAY(allowed_payment_methods, '$.paymentMethods'), ', ') AS allowed_payment_methods,\n    SAFE.JSON_VALUE(selected_payment_method, '$.kind') AS selected_payment_kind,\n    SAFE.JSON_VALUE(selected_payment_method, '$.paymentMethodType') AS selected_payment_method_type,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.downPayment.grossPrice') AS down_payment_gross,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.financedAmount.grossPrice') AS financed_amount_gross,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.monthlyRate.grossPrice') AS monthly_rate_gross,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.rateCount') AS rate_count,\n    SAFE.JSON_VALUE(selected_payment_method, '$.chosenOption.totalAmount.grossPrice') AS total_amount_gross,\n    SAFE.JSON_VALUE(payment_data, '$.iban') AS iban,\n    SAFE.JSON_VALUE(payment_data, '$.kind') AS payment_kind,\n    SAFE.JSON_VALUE(payment_data, '$.paymentMethod') AS payment_method,\n    SAFE.JSON_VALUE(invoice_data, '$.createdAt') AS invoice_created_at,\n    SAFE.JSON_VALUE(invoice_data, '$.invoiceId') AS invoice_id,\n    SAFE.JSON_VALUE(invoice_data, '$.invoiceNumber') AS invoice_number,\n    SAFE.JSON_VALUE(invoice_data, '$.kind') AS invoice_kind,\n    SAFE.JSON_VALUE(invoice_data, '$.fileData.documentFileId') AS document_file_id,\n    SAFE.JSON_VALUE(invoice_data, '$.fileData.fileDescriptionId') AS file_description_id,\n    SAFE.JSON_VALUE(payment_data, '$.mandateInformation.acceptanceDateTime') AS mandate_acceptance_datetime,\n    SAFE.JSON_VALUE(payment_data, '$.mandateInformation.mandateNumber') AS mandate_number,\n    SAFE.JSON_VALUE(deletion_info, '$.isDeleted') AS is_deleted,\n    SAFE.JSON_VALUE(deletion_info, '$.kind') AS deletion_kind\n  FROM billing_orders_base\n),\n\nunnest_cart_items AS (\n  SELECT \n    unnest_data.* EXCEPT (cart),\n    ARRAY_TO_STRING(JSON_VALUE_ARRAY(cart, '$.discountCodeRefusals'), ', ') AS cart_discount_code_refusals,\n\n    -- Items (Using UNNEST)\n    SAFE.JSON_VALUE(item, '$.amount') AS cart_item_amount,\n    SAFE.JSON_VALUE(item, '$.kind') AS cart_item_kind,\n    REPLACE(SAFE.JSON_VALUE(item, '$.productId'), \"Product:\", '') AS cart_item_product_id,\n    SAFE.JSON_VALUE(item, '$.individualPrice.grossPrice') AS cart_item_gross_price,\n    SAFE.JSON_VALUE(item, '$.individualPrice.netPrice') AS cart_item_net_price,\n    SAFE.JSON_VALUE(item, '$.individualPrice.taxRatePercentage') AS cart_item_tax_rate,\n    SAFE.JSON_VALUE(item, '$.totalPrice.grossPrice') AS cart_item_total_gross_price,\n    SAFE.JSON_VALUE(item, '$.totalPrice.netPrice') AS cart_item_total_net_price,\n    SAFE.JSON_VALUE(item, '$.totalPrice.taxRatePercentage') AS cart_item_total_tax_rate,\n\n    -- Selection (Arrays)\n    ARRAY_TO_STRING(JSON_VALUE_ARRAY(cart, '$.selection.selectedDiscountCodes'), ', ') AS cart_selected_discount_codes,\n    SAFE.JSON_VALUE(selected_product, '$.amount') AS cart_selected_product_amount,\n    REPLACE(SAFE.JSON_VALUE(selected_product, '$.productId'), \"Product:\", '') AS cart_selected_product_id,\n\n    -- Totals\n    SAFE.JSON_VALUE(cart, '$.totals.appliedDiscount.grossPrice') AS cart_applied_discount_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.appliedDiscount.netPrice') AS cart_applied_discount_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.appliedDiscount.taxRatePercentage') AS cart_applied_discount_tax_rate,\n    SAFE.JSON_VALUE(cart, '$.totals.appliedDiscountPercentage') AS cart_applied_discount_percentage,\n    SAFE.JSON_VALUE(cart, '$.totals.includingAllDiscounts.grossPrice') AS cart_including_all_discounts_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.includingAllDiscounts.netPrice') AS cart_including_all_discounts_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.includingAllDiscounts.taxRatePercentage') AS cart_including_all_discounts_tax_rate,\n\n    -- Monthly Options\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.downPayment.grossPrice') AS cart_monthly_downpayment_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.downPayment.netPrice') AS cart_monthly_downpayment_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.downPayment.taxRatePercentage') AS cart_monthly_downpayment_tax_rate,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.financedAmount.grossPrice') AS cart_monthly_financed_amount_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.financedAmount.netPrice') AS cart_monthly_financed_amount_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.financedAmount.taxRatePercentage') AS cart_monthly_financed_amount_tax_rate,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.monthlyRate.grossPrice') AS cart_monthly_rate_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.monthlyRate.netPrice') AS cart_monthly_rate_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.monthlyRate.taxRatePercentage') AS cart_monthly_rate_tax_rate,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.rateCount') AS cart_monthly_rate_count,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.totalAmount.grossPrice') AS cart_monthly_total_amount_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.totalAmount.netPrice') AS cart_monthly_total_amount_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.monthlyOptions.totalAmount.taxRatePercentage') AS cart_monthly_total_amount_tax_rate,\n\n    -- Without Discounts\n    SAFE.JSON_VALUE(cart, '$.totals.withoutDiscounts.grossPrice') AS cart_without_discounts_gross_price,\n    SAFE.JSON_VALUE(cart, '$.totals.withoutDiscounts.netPrice') AS cart_without_discounts_net_price,\n    SAFE.JSON_VALUE(cart, '$.totals.withoutDiscounts.taxRatePercentage') AS cart_without_discounts_tax_rate\n  \n  FROM unnest_data \n  LEFT JOIN UNNEST(JSON_QUERY_ARRAY(cart, '$.items')) AS item\n  LEFT JOIN UNNEST(JSON_QUERY_ARRAY(cart, '$.selection.selectedProducts')) AS selected_product\n\n)\n\nSELECT * FROM unnest_cart_items", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`base_billing_orders`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T14:30:34.817776Z", "completed_at": "2025-05-13T14:30:34.824969Z"}, {"name": "execute", "started_at": "2025-05-13T14:30:34.825614Z", "completed_at": "2025-05-13T14:30:54.946405Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 20.13125967979431, "adapter_response": {"_message": "CREATE TABLE (2.6k rows, 13.5 MiB processed)", "code": "CREATE TABLE", "rows_affected": 2564, "bytes_processed": 14167366, "bytes_billed": 14680064, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "1788d6bc-1dad-4445-b894-5ca8129a2609", "slot_ms": 4174034}, "message": "CREATE TABLE (2.6k rows, 13.5 MiB processed)", "failures": null, "unique_id": "model.key_academy.stg_agg_checkout_funnel_summary", "compiled": true, "compiled_code": "\n\nWITH user_first_appearance AS (\n  SELECT\n    user_id,\n    MIN(created_at) AS first_appearance_date\n  FROM `intrepid-craft-450709-f9`.`key_academy`.`base_billing_orders`\n  GROUP BY user_id\n),\n\nbase_with_customer_type AS (\n  SELECT\n    order_id,\n    created_at,\n    DATE(created_at) AS created_date,\n    user_id,\n    billing_order_status,\n    CASE\n      WHEN created_at = ufa.first_appearance_date THEN 'New'\n      ELSE 'Returning'\n    END AS customer_type\n  FROM `intrepid-craft-450709-f9`.`key_academy`.`base_billing_orders`\n  LEFT JOIN user_first_appearance ufa USING(user_id)\n)\n\nSELECT\n  created_date,\n  customer_type,\n  SUM(CASE WHEN billing_order_status = 'HasCart' THEN 1 ELSE 0 END) AS has_cart,\n  SUM(CASE WHEN billing_order_status = 'HasBillingDetails' THEN 1 ELSE 0 END) AS has_billing_details,\n  SUM(CASE WHEN billing_order_status = 'HasPaymentDetails' THEN 1 ELSE 0 END) AS has_payment_details,\n  SUM(CASE WHEN billing_order_status = 'Purchased' THEN 1 ELSE 0 END) AS purchased,\nFROM base_with_customer_type\nGROUP BY ALL", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`stg_agg_checkout_funnel_summary`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-13T14:30:54.951196Z", "completed_at": "2025-05-13T14:30:54.955290Z"}, {"name": "execute", "started_at": "2025-05-13T14:30:54.956011Z", "completed_at": "2025-05-13T14:31:22.559144Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 27.609684228897095, "adapter_response": {"_message": "CREATE TABLE (2.6k rows, 120.1 KiB processed)", "code": "CREATE TABLE", "rows_affected": 2564, "bytes_processed": 122940, "bytes_billed": 10485760, "location": "US", "project_id": "intrepid-craft-450709-f9", "job_id": "70a883f3-b2d9-48ee-8881-783b0a4affe4", "slot_ms": 2540989}, "message": "CREATE TABLE (2.6k rows, 120.1 KiB processed)", "failures": null, "unique_id": "model.key_academy.mart_agg_checkout_funnel_summary", "compiled": true, "compiled_code": "\n\nSELECT * \nFROM `intrepid-craft-450709-f9`.`key_academy`.`stg_agg_checkout_funnel_summary`", "relation_name": "`intrepid-craft-450709-f9`.`key_academy`.`mart_agg_checkout_funnel_summary`", "batch_results": null}], "elapsed_time": 63.13943672180176, "args": {"defer": false, "require_batched_execution_for_custom_microbatch_strategy": false, "vars": {}, "source_freshness_run_project_hooks": false, "invocation_command": "dbt run -s +mart_agg_checkout_funnel_summary --full-refresh", "show_resource_report": false, "which": "run", "require_yaml_configuration_for_mf_time_spines": false, "log_file_max_bytes": 10485760, "write_json": true, "log_path": "/home/jddeguia/key-academy/key_academy/logs", "empty": false, "exclude": [], "log_level": "info", "use_colors": true, "partial_parse_file_diff": true, "send_anonymous_usage_stats": true, "static_parser": true, "require_explicit_package_overrides_for_builtin_materializations": true, "log_format": "default", "state_modified_compare_vars": false, "full_refresh": true, "partial_parse": true, "warn_error_options": {"include": [], "exclude": []}, "macro_debugging": false, "cache_selected_only": false, "version_check": true, "require_nested_cumulative_type_params": false, "log_level_file": "debug", "populate_cache": true, "state_modified_compare_more_unrendered_values": false, "indirect_selection": "eager", "require_resource_names_without_spaces": false, "strict_mode": false, "select": ["+mart_agg_checkout_funnel_summary"], "introspect": true, "project_dir": "/home/jddeguia/key-academy/key_academy", "use_colors_file": true, "quiet": false, "profiles_dir": "/home/jddeguia/.dbt", "skip_nodes_if_on_run_start_fails": false, "print": true, "favor_state": false, "printer_width": 80, "log_format_file": "debug"}}